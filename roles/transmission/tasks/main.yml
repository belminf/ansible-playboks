---

- name: packages
  package: name={{ item }} state=latest
  with_items:
    - transmission-cli
    - transmission-daemon
    - transmission-common

- name: configuration
  lineinfile:
    path: /etc/transmission-daemon/settings.json
    regexp: "^    \"{{ item.name }}\""
    line: "    \"{{ item.name }}\": {{ item.value }}, "
  with_items:
    - { name: 'rpc-whitelist', value: "\"{{ transmission_whitelist }}\"" }
    - { name: 'port-forwarding-enabled', value: "{{ transmission_port_fwd }}" }
    - { name: 'peer-port-random-on-start', value: "{{ transmission_random_port }}" }
    - { name: 'ratio-limit', value: "{{ '%.4f'|format(transmission_ratio_limit|float) }}" }
    - { name: 'ratio-limit-enabled', value: "{{ transmission_ratio_limit_enabled }}" }
    - { name: 'idle-seeding-limit', value: "{{ transmission_idle_seeding_limit }}" }
    - { name: 'idle-seeding-limit-enabled', value: "{{ transmission_idle_seeding_limit_enabled }}" }
  notify: reload transmission config
